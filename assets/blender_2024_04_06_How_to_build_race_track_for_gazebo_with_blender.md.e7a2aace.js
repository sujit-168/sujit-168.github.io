import{_ as p}from"./chunks/ArticleMetadata.1f2d3a8b.js";import{_ as r,C as c,o as n,c as i,H as d,w as y,k as e,a as b,Q as h,b as u,e as m}from"./chunks/framework.4303053c.js";import"./chunks/md5.3e7612d8.js";const q=JSON.parse('{"title":"如何使用 Blender 构建 Gazebo 的赛道","description":"","frontmatter":{"title":"如何使用 Blender 构建 Gazebo 的赛道","date":"2024-04-06 11:23","categories":["Blender","ros","Gazebo"],"tags":["ROS","Gazebo",".world",".dae",".STL"],"copyright":true},"headers":[],"relativePath":"blender/2024/04/06/How_to_build_race_track_for_gazebo_with_blender.md","filePath":"blender/2024/04/06/How_to_build_race_track_for_gazebo_with_blender.md","lastUpdated":1713023705000}'),g={name:"blender/2024/04/06/How_to_build_race_track_for_gazebo_with_blender.md"},A=e("h1",{id:"如何正确导出一个-gazebo-的-world-文件",tabindex:"-1"},[b("如何正确导出一个 gazebo 的 world 文件 "),e("a",{class:"header-anchor",href:"#如何正确导出一个-gazebo-的-world-文件","aria-label":'Permalink to "如何正确导出一个 gazebo 的 world 文件"'},"​")],-1),D=h(`<h2 id="准备工作" tabindex="-1">准备工作 <a class="header-anchor" href="#准备工作" aria-label="Permalink to &quot;准备工作&quot;">​</a></h2><ul><li>一个带有 UV 贴图纹理的<code>.dae</code>文件</li><li>基于<strong>Ubuntu 18.04</strong>的<strong>gazebo9</strong> (兼容性好一些)</li></ul><h2 id="操作流程" tabindex="-1">操作流程 <a class="header-anchor" href="#操作流程" aria-label="Permalink to &quot;操作流程&quot;">​</a></h2><h3 id="进入-model-editor-模式" tabindex="-1">进入 Model Editor 模式 <a class="header-anchor" href="#进入-model-editor-模式" aria-label="Permalink to &quot;进入 Model Editor 模式&quot;">​</a></h3><ol><li>打开 gazebo，进入 Model Editor 模式</li></ol><h3 id="导入模型文件" tabindex="-1">导入模型文件 <a class="header-anchor" href="#导入模型文件" aria-label="Permalink to &quot;导入模型文件&quot;">​</a></h3><ol><li>添加路径导入贴好 uv 贴图的.dae 文件，（此时导入进来的文件并无贴图效果）</li></ol><h3 id="手动对齐坐标轴" tabindex="-1">手动对齐坐标轴 <a class="header-anchor" href="#手动对齐坐标轴" aria-label="Permalink to &quot;手动对齐坐标轴&quot;">​</a></h3><ol><li>对其坐标轴</li></ol><h3 id="sdf模型保存" tabindex="-1"><strong>SDF</strong>模型保存 <a class="header-anchor" href="#sdf模型保存" aria-label="Permalink to &quot;**SDF**模型保存&quot;">​</a></h3><ol><li>此时需要先 save as 一个 gazebo 的 model 文件，此时仍然没有贴图效果</li><li>保存时可以选择 Advanced 模式，填写上模型的版本，作者等信息</li></ol><p>最后 exit 退出该模式，否则会丢失先前的工作。</p><h3 id="保存-world-文件" tabindex="-1">保存 world 文件 <a class="header-anchor" href="#保存-world-文件" aria-label="Permalink to &quot;保存 world 文件&quot;">​</a></h3><ol><li>此时来到主页面，无需多余的其他操作，保存为一个.world 为后缀的 sdf 文件。</li></ol><h3 id="查看-world-文件" tabindex="-1">查看 world 文件 <a class="header-anchor" href="#查看-world-文件" aria-label="Permalink to &quot;查看 world 文件&quot;">​</a></h3><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#F69D50;">gazebo</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">xxxx/xxx.world</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">gazebo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">xxxx/xxx.world</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h2 id="常见问题" tabindex="-1">常见问题 <a class="header-anchor" href="#常见问题" aria-label="Permalink to &quot;常见问题&quot;">​</a></h2><h3 id="在-gazebo-主界面导入带贴图的-sdf-模型时" tabindex="-1">在 gazebo 主界面导入带贴图的 sdf 模型时 <a class="header-anchor" href="#在-gazebo-主界面导入带贴图的-sdf-模型时" aria-label="Permalink to &quot;在 gazebo 主界面导入带贴图的 sdf 模型时&quot;">​</a></h3><p>可以正常添加，但是挪动视角时，Gazebo 会卡死。自然无法继续创建.world 文件。如需创建.world 文件，参考上面的方法</p><div class="info custom-block"><p class="custom-block-title">原因分析</p><p>这个多半是你的实体模型文件网格面数过多，比如一个曲面 (通常它的体积会在远在 100kb 之上),此时建议考虑使用 blender 或者其他软件对模型进行精简，以减少网格的面数</p></div><h3 id="使用-gazebo-命令无法启动窗口" tabindex="-1">使用 gazebo 命令无法启动窗口 <a class="header-anchor" href="#使用-gazebo-命令无法启动窗口" aria-label="Permalink to &quot;使用 gazebo 命令无法启动窗口&quot;">​</a></h3><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#F69D50;">pkill</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">-9</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">gzserver</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">pkill</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-9</span><span style="color:#24292E;"> </span><span style="color:#032F62;">gzserver</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="保存-world-文件时卡住" tabindex="-1">保存.world 文件时卡住 <a class="header-anchor" href="#保存-world-文件时卡住" aria-label="Permalink to &quot;保存.world 文件时卡住&quot;">​</a></h3><p>保存时间比较久，需要等一会</p><h3 id="gazebo-加载-world-很慢" tabindex="-1">Gazebo 加载 world 很慢 <a class="header-anchor" href="#gazebo-加载-world-很慢" aria-label="Permalink to &quot;Gazebo 加载 world 很慢&quot;">​</a></h3><p>这个问题通常是由于 <strong>world</strong> 文件中 模型的路径问题导致的</p><ul><li>将<code>&lt;uri&gt;</code>标签的全局路径修改为 <code>model:// + 相对路径</code></li></ul><div class="language-xml vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#ADBAC7;">  &lt;</span><span style="color:#8DDB8C;">mesh</span><span style="color:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="color:#ADBAC7;">      &lt;</span><span style="color:#8DDB8C;">uri</span><span style="color:#ADBAC7;">&gt;test/meshes/base_link.dae&lt;/</span><span style="color:#8DDB8C;">uri</span><span style="color:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="color:#ADBAC7;">      &lt;</span><span style="color:#8DDB8C;">scale</span><span style="color:#ADBAC7;">&gt;1 1 1&lt;/</span><span style="color:#8DDB8C;">scale</span><span style="color:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="color:#ADBAC7;">  &lt;/</span><span style="color:#8DDB8C;">mesh</span><span style="color:#ADBAC7;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">  &lt;</span><span style="color:#22863A;">mesh</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">      &lt;</span><span style="color:#22863A;">uri</span><span style="color:#24292E;">&gt;test/meshes/base_link.dae&lt;/</span><span style="color:#22863A;">uri</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">      &lt;</span><span style="color:#22863A;">scale</span><span style="color:#24292E;">&gt;1 1 1&lt;/</span><span style="color:#22863A;">scale</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">  &lt;/</span><span style="color:#22863A;">mesh</span><span style="color:#24292E;">&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="贴图不显示问题" tabindex="-1">贴图不显示问题 <a class="header-anchor" href="#贴图不显示问题" aria-label="Permalink to &quot;贴图不显示问题&quot;">​</a></h3><p>打开先前保存的 <strong>world</strong> 文件，删除其中包含的所有<code>&lt;material&gt;</code>标签，即可正常显示</p><div class="language-xml vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#ADBAC7;">    &lt;</span><span style="color:#8DDB8C;">material</span><span style="color:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="color:#ADBAC7;">      &lt;</span><span style="color:#8DDB8C;">lighting</span><span style="color:#ADBAC7;">&gt;1&lt;/</span><span style="color:#8DDB8C;">lighting</span><span style="color:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="color:#ADBAC7;">      &lt;</span><span style="color:#8DDB8C;">script</span><span style="color:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="color:#ADBAC7;">        &lt;</span><span style="color:#8DDB8C;">uri</span><span style="color:#ADBAC7;">&gt;file://media/materials/scripts/gazebo.material&lt;/</span><span style="color:#8DDB8C;">uri</span><span style="color:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="color:#ADBAC7;">        &lt;</span><span style="color:#8DDB8C;">name</span><span style="color:#ADBAC7;">&gt;Gazebo/Grey&lt;/</span><span style="color:#8DDB8C;">name</span><span style="color:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="color:#ADBAC7;">      &lt;/</span><span style="color:#8DDB8C;">script</span><span style="color:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="color:#ADBAC7;">      &lt;</span><span style="color:#8DDB8C;">shader</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">type</span><span style="color:#ADBAC7;">=</span><span style="color:#96D0FF;">&#39;pixel&#39;</span><span style="color:#ADBAC7;">/&gt;</span></span>
<span class="line"><span style="color:#ADBAC7;">    &lt;/</span><span style="color:#8DDB8C;">material</span><span style="color:#ADBAC7;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">    &lt;</span><span style="color:#22863A;">material</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">      &lt;</span><span style="color:#22863A;">lighting</span><span style="color:#24292E;">&gt;1&lt;/</span><span style="color:#22863A;">lighting</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">      &lt;</span><span style="color:#22863A;">script</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">        &lt;</span><span style="color:#22863A;">uri</span><span style="color:#24292E;">&gt;file://media/materials/scripts/gazebo.material&lt;/</span><span style="color:#22863A;">uri</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">        &lt;</span><span style="color:#22863A;">name</span><span style="color:#24292E;">&gt;Gazebo/Grey&lt;/</span><span style="color:#22863A;">name</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">      &lt;/</span><span style="color:#22863A;">script</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">      &lt;</span><span style="color:#22863A;">shader</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">type</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&#39;pixel&#39;</span><span style="color:#24292E;">/&gt;</span></span>
<span class="line"><span style="color:#24292E;">    &lt;/</span><span style="color:#22863A;">material</span><span style="color:#24292E;">&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>blender 导出的.dae 文件在 gazebo 中加载时，颜色会特别暗淡，需要修改一些文件中的参数</p><div class="language-xml vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#ADBAC7;">    &lt;</span><span style="color:#8DDB8C;">emission</span><span style="color:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="color:#ADBAC7;">        &lt;</span><span style="color:#8DDB8C;">color</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">sid</span><span style="color:#ADBAC7;">=</span><span style="color:#96D0FF;">&quot;emission&quot;</span><span style="color:#ADBAC7;">&gt;1 1 1 1&lt;/</span><span style="color:#8DDB8C;">color</span><span style="color:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="color:#ADBAC7;">    &lt;/</span><span style="color:#8DDB8C;">emission</span><span style="color:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="color:#ADBAC7;">    &lt;</span><span style="color:#8DDB8C;">ambient</span><span style="color:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="color:#ADBAC7;">        &lt;</span><span style="color:#8DDB8C;">color</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">sid</span><span style="color:#ADBAC7;">=</span><span style="color:#96D0FF;">&quot;ambient&quot;</span><span style="color:#ADBAC7;">&gt;1 1 1 1&lt;/</span><span style="color:#8DDB8C;">color</span><span style="color:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="color:#ADBAC7;">    &lt;/</span><span style="color:#8DDB8C;">ambient</span><span style="color:#ADBAC7;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">    &lt;</span><span style="color:#22863A;">emission</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">        &lt;</span><span style="color:#22863A;">color</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">sid</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;emission&quot;</span><span style="color:#24292E;">&gt;1 1 1 1&lt;/</span><span style="color:#22863A;">color</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">    &lt;/</span><span style="color:#22863A;">emission</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">    &lt;</span><span style="color:#22863A;">ambient</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">        &lt;</span><span style="color:#22863A;">color</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">sid</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;ambient&quot;</span><span style="color:#24292E;">&gt;1 1 1 1&lt;/</span><span style="color:#22863A;">color</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">    &lt;/</span><span style="color:#22863A;">ambient</span><span style="color:#24292E;">&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li><a href="https://zhuanlan.zhihu.com/p/454908515" target="_blank" rel="noreferrer">Gazebo 贴图模型制作与导入</a></li></ul><h3 id="贴图闪烁问题" tabindex="-1">贴图闪烁问题 <a class="header-anchor" href="#贴图闪烁问题" aria-label="Permalink to &quot;贴图闪烁问题&quot;">​</a></h3><p>这个问题，需要切换观察视角到地板的下方，看地板模型是否是一个实体，通常仅仅是一个悬空的平面会出现这样的问题</p><h3 id="模型出现掉落-抖动问题" tabindex="-1">模型出现掉落，抖动问题 <a class="header-anchor" href="#模型出现掉落-抖动问题" aria-label="Permalink to &quot;模型出现掉落，抖动问题&quot;">​</a></h3><p>这个问题通常是惯性系数不正确引起，根据 gazebo 的官方文档，惯性系数矩阵需要借助 meshlab 工具来进行计算</p><div class="tip custom-block"><p class="custom-block-title">注意</p><ul><li>使用 import mesh 功能时，导入.stl 这种网格实体格式，不要导入.dae 格式</li><li>导入的.stl 文件应为闭合的网格，否则会触发 waterlight 的不防水问题，导致无法正确计算惯性系数矩阵。解决方法为，将未封闭的网格封闭后重新导出。参考<a href="https://stackoverflow.com/questions/45685571/issue-with-volume-calculation" target="_blank" rel="noreferrer">Issue with volume calculation</a></li><li>每个实体模型 (stl) 导出各自的惯性矩阵，不要图省事，导入一个 dae 模型，整体计算，这种极容易出现抖动的问题</li><li>使用 Filter 下的 Quilty Measure and Computations 中的 compute Geometric Measures 功能</li></ul></div><p>具体操作细节参考<a href="./../../04/13/How_to_calc_inertia_matrix_of_model_with_meshlab">如何使用 meshlab 计算模型的惯性矩阵</a></p><h3 id="reset-world-后模型出现抖动" tabindex="-1">Reset_world 后模型出现抖动 <a class="header-anchor" href="#reset-world-后模型出现抖动" aria-label="Permalink to &quot;Reset_world 后模型出现抖动&quot;">​</a></h3><ol><li>首先确保惯性系数与 meshlab 计算一致</li><li>gazebo 加载 world 时没有问题，但是 reset world 后赛道模型一直抖动，原因多半是地板 base_link 与 wall_link 模型中的放置位置有重叠部分.(解决方法是在 blender 中重新设置两模型的位置，避免有重叠部分，然后重新导出 stl)</li></ol><div class="tip custom-block"><p class="custom-block-title">原因</p><p>gazebo 首次加载时，模型自上而下掉落放置，而使用 reset_world 时，模型则是按照 world 文件中的预设位置，直接放置，此时如果模型之间有重合部分，即出现刚体之间的 collapse 问题。</p></div>`,43);function C(s,B,_,k,w,v){const o=p,t=c("ClientOnly");return n(),i("div",null,[A,d(t,null,{default:y(()=>{var a,l;return[(((a=s.$frontmatter)==null?void 0:a.aside)??!0)&&(((l=s.$frontmatter)==null?void 0:l.showArticleMetadata)??!0)?(n(),u(o,{key:0,article:s.$frontmatter},null,8,["article"])):m("",!0)]}),_:1}),D])}const z=r(g,[["render",C]]);export{q as __pageData,z as default};
