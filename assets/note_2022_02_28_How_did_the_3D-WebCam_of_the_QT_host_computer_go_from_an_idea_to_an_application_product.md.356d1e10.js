import{_ as r}from"./chunks/ArticleMetadata.8d40e945.js";import{_ as t,C as c,o as l,c as y,H as i,w as A,k as p,a as D,Q as C,b as B,e as F}from"./chunks/framework.144d84a9.js";import"./chunks/md5.3e7612d8.js";const S=JSON.parse('{"title":"QT 上位机之 3D_WebCam 我是如何从一个想法变为一款应用","description":"","frontmatter":{"title":"QT 上位机之 3D_WebCam 我是如何从一个想法变为一款应用","date":"2022-02-28 10:15","categories":["note"],"tags":["QT"]},"headers":[],"relativePath":"note/2022/02/28/How_did_the_3D-WebCam_of_the_QT_host_computer_go_from_an_idea_to_an_application_product.md","filePath":"note/2022/02/28/How_did_the_3D-WebCam_of_the_QT_host_computer_go_from_an_idea_to_an_application_product.md","lastUpdated":1711185179000}'),u={name:"note/2022/02/28/How_did_the_3D-WebCam_of_the_QT_host_computer_go_from_an_idea_to_an_application_product.md"},d=p("h1",{id:"qt-上位机之-3d-webcam-我是如何从一个想法变为一款应用",tabindex:"-1"},[D("QT 上位机之 3D_WebCam 我是如何从一个想法变为一款应用 "),p("a",{class:"header-anchor",href:"#qt-上位机之-3d-webcam-我是如何从一个想法变为一款应用","aria-label":'Permalink to "QT 上位机之 3D_WebCam 我是如何从一个想法变为一款应用"'},"​")],-1),m=C(`<h2 id="前言" tabindex="-1">前言 <a class="header-anchor" href="#前言" aria-label="Permalink to &quot;前言&quot;">​</a></h2><p>大家好，我是一款<s>练习时长两周半</s>名为 webcam_Stereo 的上位机，由 C++ 炼制而成，以 QT5 工艺躯体框架，并且正在学习 Opencv 功法。我喜欢<s>唱跳、rap、篮球</s>换脸、拍照和录像，介绍一下，这就是我的硬件兄弟，一块 40 大洋的双目摄像头。</p><p><img src="https://cn-sy1.rains3.com/dfdfgf/blog/How_did_the_3D-WebCam_of_the_QT_host_computer_go_from_an_idea_to_an_application_product/1.png" alt=""></p><h2 id="想法" tabindex="-1">想法 <a class="header-anchor" href="#想法" aria-label="Permalink to &quot;想法&quot;">​</a></h2><p>在 terminal 中调用脚本是非常不优雅的，而且经常需要修改一些可变参数，而我也是一个怕麻烦的人。所以我开发了这款上位机。它应该具备以下的功能</p><ol><li>切换相机</li><li>切换相机输出模式</li><li>拍照</li><li>录像</li></ol><h2 id="技术选择" tabindex="-1">技术选择 <a class="header-anchor" href="#技术选择" aria-label="Permalink to &quot;技术选择&quot;">​</a></h2><p>考虑到比较熟悉 C++，并且它最好是跨平台的应用，所以选择了 QT5 作为脚手架来加速开发，通过引入第三方 Opencv 库来简化代码。</p><p>GCC 5.3.1</p><p>Ubuntu18.04 64 bit</p><p><a href="https://www.qt.io/zh-cn/product/ui-design-tools" target="_blank" rel="noreferrer">QT Creator</a>基于 Qt 5.15.1</p><p><img src="https://pica.zhimg.com/80/v2-ca47d032dcbdaba96a6f7fa6c08ad03f_720w.png" alt="img"></p><p><a href="https://opencv.org/" target="_blank" rel="noreferrer">Opencv</a>基于 Opencv4.5.2</p><h2 id="ui-部分" tabindex="-1">UI 部分 <a class="header-anchor" href="#ui-部分" aria-label="Permalink to &quot;UI 部分&quot;">​</a></h2><p>需要 1 个输出框 (QTextEdit)，1 个下拉页 (Type Here)，2 个输入框 (QLineEdit)，4 个按钮 (QPushButton)</p><table><thead><tr><th style="text-align:center;">UI 组件 (MainWindow)</th><th style="text-align:center;">数量</th></tr></thead><tbody><tr><td style="text-align:center;">QTextEdit</td><td style="text-align:center;">1</td></tr><tr><td style="text-align:center;">QLineEdit</td><td style="text-align:center;">2</td></tr><tr><td style="text-align:center;">QPushButton</td><td style="text-align:center;">4</td></tr></tbody></table><table><thead><tr><th style="text-align:center;">UI 组件 (menubar)</th><th style="text-align:center;">数量</th></tr></thead><tbody><tr><td style="text-align:center;">QAction</td><td style="text-align:center;">4</td></tr></tbody></table><p>这就是我的素颜照，唉，长相一般</p><p><img src="https://pica.zhimg.com/80/v2-bf70cf497bcd7ed7f05b1d7517fff5b4_720w.png" alt="img"></p><p>美颜后的 UI 界面</p><p><img src="https://cn-sy1.rains3.com/dfdfgf/blog/How_did_the_3D-WebCam_of_the_QT_host_computer_go_from_an_idea_to_an_application_product/stereo_01.png" alt=""></p><h2 id="功能模块" tabindex="-1">功能模块 <a class="header-anchor" href="#功能模块" aria-label="Permalink to &quot;功能模块&quot;">​</a></h2><h3 id="_1-显示画面" tabindex="-1">1.显示画面 <a class="header-anchor" href="#_1-显示画面" aria-label="Permalink to &quot;1.显示画面&quot;">​</a></h3><div class="language-c++ vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">c++</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#F47067;">void</span><span style="color:#ADBAC7;"> </span><span style="color:#F69D50;">MainWindow</span><span style="color:#ADBAC7;">::</span><span style="color:#DCBDFB;">readFrame</span><span style="color:#ADBAC7;">()</span></span>
<span class="line"><span style="color:#ADBAC7;">{</span></span>
<span class="line"><span style="color:#ADBAC7;">    cap.</span><span style="color:#DCBDFB;">read</span><span style="color:#ADBAC7;">(src_image);</span></span>
<span class="line"><span style="color:#ADBAC7;">    QImage imag </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#DCBDFB;">MatImageToQt</span><span style="color:#ADBAC7;">(src_image);</span></span>
<span class="line"><span style="color:#ADBAC7;">    ui-&gt;cameraView-&gt;</span><span style="color:#DCBDFB;">setScaledContents</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">true</span><span style="color:#ADBAC7;">);</span></span>
<span class="line"><span style="color:#ADBAC7;">    ui-&gt;cameraView-&gt;</span><span style="color:#DCBDFB;">setPixmap</span><span style="color:#ADBAC7;">(</span><span style="color:#F69D50;">QPixmap</span><span style="color:#ADBAC7;">::</span><span style="color:#DCBDFB;">fromImage</span><span style="color:#ADBAC7;">(imag));</span></span>
<span class="line"><span style="color:#ADBAC7;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;">//Mat 转成 QImage</span></span>
<span class="line"><span style="color:#F69D50;">QImage</span><span style="color:#ADBAC7;"> </span><span style="color:#F69D50;">MainWindow</span><span style="color:#ADBAC7;">::</span><span style="color:#DCBDFB;">MatImageToQt</span><span style="color:#ADBAC7;">(</span><span style="color:#F47067;">const</span><span style="color:#ADBAC7;"> </span><span style="color:#F69D50;">Mat</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">&amp;</span><span style="color:#F69D50;">src</span><span style="color:#ADBAC7;">)</span></span>
<span class="line"><span style="color:#ADBAC7;">{</span></span>
<span class="line"><span style="color:#768390;">    //CV_8UC1 8 位无符号的单通道---灰度图片</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">if</span><span style="color:#ADBAC7;">(src.</span><span style="color:#DCBDFB;">type</span><span style="color:#ADBAC7;">() </span><span style="color:#F47067;">==</span><span style="color:#ADBAC7;"> CV_8UC1)</span></span>
<span class="line"><span style="color:#ADBAC7;">    {</span></span>
<span class="line"><span style="color:#768390;">        //使用给定的大小和格式构造图像</span></span>
<span class="line"><span style="color:#768390;">        //QImage(int width, int height, Format format)</span></span>
<span class="line"><span style="color:#ADBAC7;">        QImage </span><span style="color:#DCBDFB;">qImage</span><span style="color:#ADBAC7;">(src.cols,src.rows,</span><span style="color:#F69D50;">QImage</span><span style="color:#ADBAC7;">::Format_Indexed8);</span></span>
<span class="line"><span style="color:#768390;">        //扩展颜色表的颜色数目</span></span>
<span class="line"><span style="color:#ADBAC7;">        qImage.</span><span style="color:#DCBDFB;">setColorCount</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">256</span><span style="color:#ADBAC7;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;">        //在给定的索引设置颜色</span></span>
<span class="line"><span style="color:#ADBAC7;">        </span><span style="color:#F47067;">for</span><span style="color:#ADBAC7;">(</span><span style="color:#F47067;">int</span><span style="color:#ADBAC7;"> i </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">0</span><span style="color:#ADBAC7;">; i </span><span style="color:#F47067;">&lt;</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">256</span><span style="color:#ADBAC7;">; i </span><span style="color:#F47067;">++</span><span style="color:#ADBAC7;">)</span></span>
<span class="line"><span style="color:#ADBAC7;">        {</span></span>
<span class="line"><span style="color:#768390;">            //得到一个黑白图</span></span>
<span class="line"><span style="color:#ADBAC7;">            qImage.</span><span style="color:#DCBDFB;">setColor</span><span style="color:#ADBAC7;">(i,</span><span style="color:#DCBDFB;">qRgb</span><span style="color:#ADBAC7;">(i,i,i));</span></span>
<span class="line"><span style="color:#ADBAC7;">        }</span></span>
<span class="line"><span style="color:#768390;">        //复制输入图像，data 数据段的首地址</span></span>
<span class="line"><span style="color:#ADBAC7;">        uchar </span><span style="color:#F47067;">*</span><span style="color:#ADBAC7;">pSrc </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> src.data;</span></span>
<span class="line"><span style="color:#768390;">        //</span></span>
<span class="line"><span style="color:#ADBAC7;">        </span><span style="color:#F47067;">for</span><span style="color:#ADBAC7;">(</span><span style="color:#F47067;">int</span><span style="color:#ADBAC7;"> row </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">0</span><span style="color:#ADBAC7;">; row </span><span style="color:#F47067;">&lt;</span><span style="color:#ADBAC7;"> src.rows; row </span><span style="color:#F47067;">++</span><span style="color:#ADBAC7;">)</span></span>
<span class="line"><span style="color:#ADBAC7;">        {</span></span>
<span class="line"><span style="color:#768390;">            //遍历像素指针</span></span>
<span class="line"><span style="color:#ADBAC7;">            uchar </span><span style="color:#F47067;">*</span><span style="color:#ADBAC7;">pDest </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> qImage.</span><span style="color:#DCBDFB;">scanLine</span><span style="color:#ADBAC7;">(row);</span></span>
<span class="line"><span style="color:#768390;">            //从源 src 所指的内存地址的起始位置开始拷贝 n 个</span></span>
<span class="line"><span style="color:#768390;">            //字节到目标 dest 所指的内存地址的起始位置中</span></span>
<span class="line"><span style="color:#ADBAC7;">            </span><span style="color:#DCBDFB;">memcpy</span><span style="color:#ADBAC7;">(pDest,pSrc,src.cols);</span></span>
<span class="line"><span style="color:#768390;">            //图像层像素地址</span></span>
<span class="line"><span style="color:#ADBAC7;">            pSrc </span><span style="color:#F47067;">+=</span><span style="color:#ADBAC7;"> src.step;</span></span>
<span class="line"><span style="color:#ADBAC7;">        }</span></span>
<span class="line"><span style="color:#ADBAC7;">        </span><span style="color:#F47067;">return</span><span style="color:#ADBAC7;"> qImage;</span></span>
<span class="line"><span style="color:#ADBAC7;">    }</span></span>
<span class="line"><span style="color:#768390;">    //为 3 通道的彩色图片</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">else</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">if</span><span style="color:#ADBAC7;">(src.</span><span style="color:#DCBDFB;">type</span><span style="color:#ADBAC7;">() </span><span style="color:#F47067;">==</span><span style="color:#ADBAC7;"> CV_8UC3)</span></span>
<span class="line"><span style="color:#ADBAC7;">    {</span></span>
<span class="line"><span style="color:#768390;">        //得到图像的的首地址</span></span>
<span class="line"><span style="color:#ADBAC7;">        </span><span style="color:#F47067;">const</span><span style="color:#ADBAC7;"> uchar </span><span style="color:#F47067;">*</span><span style="color:#ADBAC7;">pSrc </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> (</span><span style="color:#F47067;">const</span><span style="color:#ADBAC7;"> uchar</span><span style="color:#F47067;">*</span><span style="color:#ADBAC7;">)src.data;</span></span>
<span class="line"><span style="color:#768390;">        //以 src 构造图片</span></span>
<span class="line"><span style="color:#ADBAC7;">        QImage </span><span style="color:#DCBDFB;">qImage</span><span style="color:#ADBAC7;">(pSrc,src.cols,src.rows,src.step,</span><span style="color:#F69D50;">QImage</span><span style="color:#ADBAC7;">::Format_RGB888);</span></span>
<span class="line"><span style="color:#768390;">        //在不改变实际图像数据的条件下，交换红蓝通道</span></span>
<span class="line"><span style="color:#ADBAC7;">        </span><span style="color:#F47067;">return</span><span style="color:#ADBAC7;"> qImage.</span><span style="color:#DCBDFB;">rgbSwapped</span><span style="color:#ADBAC7;">();</span></span>
<span class="line"><span style="color:#ADBAC7;">    }</span></span>
<span class="line"><span style="color:#768390;">    //四通道图片，带 Alpha 通道的 RGB 彩色图像</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">else</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">if</span><span style="color:#ADBAC7;">(src.</span><span style="color:#DCBDFB;">type</span><span style="color:#ADBAC7;">() </span><span style="color:#F47067;">==</span><span style="color:#ADBAC7;"> CV_8UC4)</span></span>
<span class="line"><span style="color:#ADBAC7;">    {</span></span>
<span class="line"><span style="color:#ADBAC7;">        </span><span style="color:#F47067;">const</span><span style="color:#ADBAC7;"> uchar </span><span style="color:#F47067;">*</span><span style="color:#ADBAC7;">pSrc </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> (</span><span style="color:#F47067;">const</span><span style="color:#ADBAC7;"> uchar</span><span style="color:#F47067;">*</span><span style="color:#ADBAC7;">)src.data;</span></span>
<span class="line"><span style="color:#ADBAC7;">        QImage </span><span style="color:#DCBDFB;">qImage</span><span style="color:#ADBAC7;">(pSrc, src.cols, src.rows, src.step, </span><span style="color:#F69D50;">QImage</span><span style="color:#ADBAC7;">::Format_ARGB32);</span></span>
<span class="line"><span style="color:#768390;">        //返回图像的子区域作为一个新图像</span></span>
<span class="line"><span style="color:#ADBAC7;">        </span><span style="color:#F47067;">return</span><span style="color:#ADBAC7;"> qImage.</span><span style="color:#DCBDFB;">copy</span><span style="color:#ADBAC7;">();</span></span>
<span class="line"><span style="color:#ADBAC7;">    }</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">else</span></span>
<span class="line"><span style="color:#ADBAC7;">    {</span></span>
<span class="line"><span style="color:#ADBAC7;">        </span><span style="color:#F47067;">return</span><span style="color:#ADBAC7;"> </span><span style="color:#DCBDFB;">QImage</span><span style="color:#ADBAC7;">();</span></span>
<span class="line"><span style="color:#ADBAC7;">    }</span></span>
<span class="line"><span style="color:#ADBAC7;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">MainWindow</span><span style="color:#24292E;">::</span><span style="color:#6F42C1;">readFrame</span><span style="color:#24292E;">()</span></span>
<span class="line"><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">    cap.</span><span style="color:#6F42C1;">read</span><span style="color:#24292E;">(src_image);</span></span>
<span class="line"><span style="color:#24292E;">    QImage imag </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">MatImageToQt</span><span style="color:#24292E;">(src_image);</span></span>
<span class="line"><span style="color:#24292E;">    ui-&gt;cameraView-&gt;</span><span style="color:#6F42C1;">setScaledContents</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">true</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">    ui-&gt;cameraView-&gt;</span><span style="color:#6F42C1;">setPixmap</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">QPixmap</span><span style="color:#24292E;">::</span><span style="color:#6F42C1;">fromImage</span><span style="color:#24292E;">(imag));</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//Mat 转成 QImage</span></span>
<span class="line"><span style="color:#6F42C1;">QImage</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">MainWindow</span><span style="color:#24292E;">::</span><span style="color:#6F42C1;">MatImageToQt</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Mat</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&amp;</span><span style="color:#E36209;">src</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#6A737D;">    //CV_8UC1 8 位无符号的单通道---灰度图片</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">if</span><span style="color:#24292E;">(src.</span><span style="color:#6F42C1;">type</span><span style="color:#24292E;">() </span><span style="color:#D73A49;">==</span><span style="color:#24292E;"> CV_8UC1)</span></span>
<span class="line"><span style="color:#24292E;">    {</span></span>
<span class="line"><span style="color:#6A737D;">        //使用给定的大小和格式构造图像</span></span>
<span class="line"><span style="color:#6A737D;">        //QImage(int width, int height, Format format)</span></span>
<span class="line"><span style="color:#24292E;">        QImage </span><span style="color:#6F42C1;">qImage</span><span style="color:#24292E;">(src.cols,src.rows,</span><span style="color:#6F42C1;">QImage</span><span style="color:#24292E;">::Format_Indexed8);</span></span>
<span class="line"><span style="color:#6A737D;">        //扩展颜色表的颜色数目</span></span>
<span class="line"><span style="color:#24292E;">        qImage.</span><span style="color:#6F42C1;">setColorCount</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">256</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">        //在给定的索引设置颜色</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">for</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> i </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">; i </span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">256</span><span style="color:#24292E;">; i </span><span style="color:#D73A49;">++</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">        {</span></span>
<span class="line"><span style="color:#6A737D;">            //得到一个黑白图</span></span>
<span class="line"><span style="color:#24292E;">            qImage.</span><span style="color:#6F42C1;">setColor</span><span style="color:#24292E;">(i,</span><span style="color:#6F42C1;">qRgb</span><span style="color:#24292E;">(i,i,i));</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"><span style="color:#6A737D;">        //复制输入图像，data 数据段的首地址</span></span>
<span class="line"><span style="color:#24292E;">        uchar </span><span style="color:#D73A49;">*</span><span style="color:#24292E;">pSrc </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> src.data;</span></span>
<span class="line"><span style="color:#6A737D;">        //</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">for</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> row </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">; row </span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;"> src.rows; row </span><span style="color:#D73A49;">++</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">        {</span></span>
<span class="line"><span style="color:#6A737D;">            //遍历像素指针</span></span>
<span class="line"><span style="color:#24292E;">            uchar </span><span style="color:#D73A49;">*</span><span style="color:#24292E;">pDest </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> qImage.</span><span style="color:#6F42C1;">scanLine</span><span style="color:#24292E;">(row);</span></span>
<span class="line"><span style="color:#6A737D;">            //从源 src 所指的内存地址的起始位置开始拷贝 n 个</span></span>
<span class="line"><span style="color:#6A737D;">            //字节到目标 dest 所指的内存地址的起始位置中</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">memcpy</span><span style="color:#24292E;">(pDest,pSrc,src.cols);</span></span>
<span class="line"><span style="color:#6A737D;">            //图像层像素地址</span></span>
<span class="line"><span style="color:#24292E;">            pSrc </span><span style="color:#D73A49;">+=</span><span style="color:#24292E;"> src.step;</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> qImage;</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#6A737D;">    //为 3 通道的彩色图片</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">else</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">if</span><span style="color:#24292E;">(src.</span><span style="color:#6F42C1;">type</span><span style="color:#24292E;">() </span><span style="color:#D73A49;">==</span><span style="color:#24292E;"> CV_8UC3)</span></span>
<span class="line"><span style="color:#24292E;">    {</span></span>
<span class="line"><span style="color:#6A737D;">        //得到图像的的首地址</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> uchar </span><span style="color:#D73A49;">*</span><span style="color:#24292E;">pSrc </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> (</span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> uchar</span><span style="color:#D73A49;">*</span><span style="color:#24292E;">)src.data;</span></span>
<span class="line"><span style="color:#6A737D;">        //以 src 构造图片</span></span>
<span class="line"><span style="color:#24292E;">        QImage </span><span style="color:#6F42C1;">qImage</span><span style="color:#24292E;">(pSrc,src.cols,src.rows,src.step,</span><span style="color:#6F42C1;">QImage</span><span style="color:#24292E;">::Format_RGB888);</span></span>
<span class="line"><span style="color:#6A737D;">        //在不改变实际图像数据的条件下，交换红蓝通道</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> qImage.</span><span style="color:#6F42C1;">rgbSwapped</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#6A737D;">    //四通道图片，带 Alpha 通道的 RGB 彩色图像</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">else</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">if</span><span style="color:#24292E;">(src.</span><span style="color:#6F42C1;">type</span><span style="color:#24292E;">() </span><span style="color:#D73A49;">==</span><span style="color:#24292E;"> CV_8UC4)</span></span>
<span class="line"><span style="color:#24292E;">    {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> uchar </span><span style="color:#D73A49;">*</span><span style="color:#24292E;">pSrc </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> (</span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> uchar</span><span style="color:#D73A49;">*</span><span style="color:#24292E;">)src.data;</span></span>
<span class="line"><span style="color:#24292E;">        QImage </span><span style="color:#6F42C1;">qImage</span><span style="color:#24292E;">(pSrc, src.cols, src.rows, src.step, </span><span style="color:#6F42C1;">QImage</span><span style="color:#24292E;">::Format_ARGB32);</span></span>
<span class="line"><span style="color:#6A737D;">        //返回图像的子区域作为一个新图像</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> qImage.</span><span style="color:#6F42C1;">copy</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">else</span></span>
<span class="line"><span style="color:#24292E;">    {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">QImage</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br></div></div><ul><li>如何用 OpenCV 来获取到图像输出？</li></ul><ol><li>首先需要定义一个 Mat 数据容器，用来存放摄像头的实时画面数据；</li><li>然后使用 VideoCapture() 函数来获取摄像头的实时画面数据，将读取到的每帧摄像头数据，写到 Mat 数据容器 (frame)；</li><li>判断 frame 是否为空，如果不为空，用一个窗口来显示摄像头的画面。</li></ol><h3 id="_2-模式切换" tabindex="-1">2.模式切换 <a class="header-anchor" href="#_2-模式切换" aria-label="Permalink to &quot;2.模式切换&quot;">​</a></h3><div class="language-c++ vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">c++</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#F47067;">void</span><span style="color:#ADBAC7;"> </span><span style="color:#F69D50;">MainWindow</span><span style="color:#ADBAC7;">::</span><span style="color:#DCBDFB;">on_modeswitch_clicked</span><span style="color:#ADBAC7;">()</span></span>
<span class="line"><span style="color:#ADBAC7;">{</span></span>
<span class="line"><span style="color:#ADBAC7;">    process-&gt;</span><span style="color:#DCBDFB;">start</span><span style="color:#ADBAC7;">(</span><span style="color:#96D0FF;">&quot;bash&quot;</span><span style="color:#ADBAC7;">);</span><span style="color:#768390;">                      //启动终端 (Windows 下改为 cmd)</span></span>
<span class="line"><span style="color:#ADBAC7;">    process-&gt;</span><span style="color:#DCBDFB;">waitForStarted</span><span style="color:#ADBAC7;">();</span><span style="color:#768390;">                   //等待启动完成</span></span>
<span class="line"><span style="color:#768390;">    // 切换相机输出模式</span></span>
<span class="line"><span style="color:#768390;">    //QString 的 arg() 方法用于填充字符串中的%1,%2...为给定的参数</span></span>
<span class="line"><span style="color:#ADBAC7;">    QString str1</span><span style="color:#F47067;">=</span><span style="color:#DCBDFB;">tr</span><span style="color:#ADBAC7;">(</span><span style="color:#96D0FF;">&quot;uvcdynctrl -d /dev/video%1 -S 6:8  &#39;(LE)0x50ff&#39; &quot;</span><span style="color:#ADBAC7;">).</span><span style="color:#DCBDFB;">arg</span><span style="color:#ADBAC7;">(device);</span></span>
<span class="line"><span style="color:#ADBAC7;">    QString str2</span><span style="color:#F47067;">=</span><span style="color:#DCBDFB;">tr</span><span style="color:#ADBAC7;">(</span><span style="color:#96D0FF;">&quot;uvcdynctrl -d /dev/video%1 -S 6:15 &#39;(LE)0x00f6&#39; &quot;</span><span style="color:#ADBAC7;">).</span><span style="color:#DCBDFB;">arg</span><span style="color:#ADBAC7;">(device);</span></span>
<span class="line"><span style="color:#ADBAC7;">    QString str3</span><span style="color:#F47067;">=</span><span style="color:#DCBDFB;">tr</span><span style="color:#ADBAC7;">(</span><span style="color:#96D0FF;">&quot;uvcdynctrl -d /dev/video%1 -S 6:8  &#39;(LE)0x2500&#39; &quot;</span><span style="color:#ADBAC7;">).</span><span style="color:#DCBDFB;">arg</span><span style="color:#ADBAC7;">(device);</span></span>
<span class="line"><span style="color:#ADBAC7;">    QString str4</span><span style="color:#F47067;">=</span><span style="color:#DCBDFB;">tr</span><span style="color:#ADBAC7;">(</span><span style="color:#96D0FF;">&quot;uvcdynctrl -d /dev/video%1 -S 6:8  &#39;(LE)0x5ffe&#39; &quot;</span><span style="color:#ADBAC7;">).</span><span style="color:#DCBDFB;">arg</span><span style="color:#ADBAC7;">(device);</span></span>
<span class="line"><span style="color:#ADBAC7;">    QString str5</span><span style="color:#F47067;">=</span><span style="color:#DCBDFB;">tr</span><span style="color:#ADBAC7;">(</span><span style="color:#96D0FF;">&quot;uvcdynctrl -d /dev/video%1 -S 6:15 &#39;(LE)0x0003&#39; &quot;</span><span style="color:#ADBAC7;">).</span><span style="color:#DCBDFB;">arg</span><span style="color:#ADBAC7;">(device);</span></span>
<span class="line"><span style="color:#ADBAC7;">    QString str6</span><span style="color:#F47067;">=</span><span style="color:#DCBDFB;">tr</span><span style="color:#ADBAC7;">(</span><span style="color:#96D0FF;">&quot;uvcdynctrl -d /dev/video%1 -S 6:15 &#39;(LE)0x0002&#39; &quot;</span><span style="color:#ADBAC7;">).</span><span style="color:#DCBDFB;">arg</span><span style="color:#ADBAC7;">(device);</span></span>
<span class="line"><span style="color:#ADBAC7;">    QString str7</span><span style="color:#F47067;">=</span><span style="color:#DCBDFB;">tr</span><span style="color:#ADBAC7;">(</span><span style="color:#96D0FF;">&quot;uvcdynctrl -d /dev/video%1 -S 6:15 &#39;(LE)0x0012&#39; &quot;</span><span style="color:#ADBAC7;">).</span><span style="color:#DCBDFB;">arg</span><span style="color:#ADBAC7;">(device);</span></span>
<span class="line"><span style="color:#ADBAC7;">    QString str8</span><span style="color:#F47067;">=</span><span style="color:#DCBDFB;">tr</span><span style="color:#ADBAC7;">(</span><span style="color:#96D0FF;">&quot;uvcdynctrl -d /dev/video%1 -S 6:15 &#39;(LE)0x0004&#39; &quot;</span><span style="color:#ADBAC7;">).</span><span style="color:#DCBDFB;">arg</span><span style="color:#ADBAC7;">(device);</span></span>
<span class="line"><span style="color:#ADBAC7;">    QString str9</span><span style="color:#F47067;">=</span><span style="color:#DCBDFB;">tr</span><span style="color:#ADBAC7;">(</span><span style="color:#96D0FF;">&quot;uvcdynctrl -d /dev/video%1 -S 6:8  &#39;(LE)0x76c3&#39; &quot;</span><span style="color:#ADBAC7;">).</span><span style="color:#DCBDFB;">arg</span><span style="color:#ADBAC7;">(device);</span></span>
<span class="line"><span style="color:#ADBAC7;">    QString str10</span><span style="color:#F47067;">=</span><span style="color:#DCBDFB;">tr</span><span style="color:#ADBAC7;">(</span><span style="color:#96D0FF;">&quot;uvcdynctrl -d /dev/video%1 -S 6:10 &#39;(LE)0x0%200&#39;&quot;</span><span style="color:#ADBAC7;">).</span><span style="color:#DCBDFB;">arg</span><span style="color:#ADBAC7;">(device).</span><span style="color:#DCBDFB;">arg</span><span style="color:#ADBAC7;">(mode);</span><span style="color:#768390;">  //可变参数</span></span>
<span class="line"><span style="color:#ADBAC7;">    QString array[</span><span style="color:#6CB6FF;">10</span><span style="color:#ADBAC7;">]</span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;">{str1,str2,str3,str4,str5,str6,str7,str8,str9,str10};</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">char</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">*</span><span style="color:#ADBAC7;">n;</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">for</span><span style="color:#ADBAC7;">(</span><span style="color:#F47067;">int</span><span style="color:#ADBAC7;"> i</span><span style="color:#F47067;">=</span><span style="color:#6CB6FF;">0</span><span style="color:#ADBAC7;">;i</span><span style="color:#F47067;">&lt;</span><span style="color:#6CB6FF;">10</span><span style="color:#ADBAC7;">;i</span><span style="color:#F47067;">++</span><span style="color:#ADBAC7;">){</span></span>
<span class="line"><span style="color:#ADBAC7;">        QByteArray m</span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;">array[i].</span><span style="color:#DCBDFB;">toLatin1</span><span style="color:#ADBAC7;">();</span></span>
<span class="line"><span style="color:#ADBAC7;">        n</span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;">m.</span><span style="color:#DCBDFB;">data</span><span style="color:#ADBAC7;">();</span></span>
<span class="line"><span style="color:#ADBAC7;">        process-&gt;</span><span style="color:#DCBDFB;">write</span><span style="color:#ADBAC7;">(n);</span></span>
<span class="line"><span style="color:#ADBAC7;">        process-&gt;</span><span style="color:#DCBDFB;">write</span><span style="color:#ADBAC7;">(</span><span style="color:#96D0FF;">&quot;</span><span style="color:#F47067;">\\n</span><span style="color:#96D0FF;">&quot;</span><span style="color:#ADBAC7;">);</span><span style="color:#768390;">	//不可省略</span></span>
<span class="line"><span style="color:#ADBAC7;">    }</span></span>
<span class="line"><span style="color:#ADBAC7;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">MainWindow</span><span style="color:#24292E;">::</span><span style="color:#6F42C1;">on_modeswitch_clicked</span><span style="color:#24292E;">()</span></span>
<span class="line"><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">    process-&gt;</span><span style="color:#6F42C1;">start</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;bash&quot;</span><span style="color:#24292E;">);</span><span style="color:#6A737D;">                      //启动终端 (Windows 下改为 cmd)</span></span>
<span class="line"><span style="color:#24292E;">    process-&gt;</span><span style="color:#6F42C1;">waitForStarted</span><span style="color:#24292E;">();</span><span style="color:#6A737D;">                   //等待启动完成</span></span>
<span class="line"><span style="color:#6A737D;">    // 切换相机输出模式</span></span>
<span class="line"><span style="color:#6A737D;">    //QString 的 arg() 方法用于填充字符串中的%1,%2...为给定的参数</span></span>
<span class="line"><span style="color:#24292E;">    QString str1</span><span style="color:#D73A49;">=</span><span style="color:#6F42C1;">tr</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;uvcdynctrl -d /dev/video%1 -S 6:8  &#39;(LE)0x50ff&#39; &quot;</span><span style="color:#24292E;">).</span><span style="color:#6F42C1;">arg</span><span style="color:#24292E;">(device);</span></span>
<span class="line"><span style="color:#24292E;">    QString str2</span><span style="color:#D73A49;">=</span><span style="color:#6F42C1;">tr</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;uvcdynctrl -d /dev/video%1 -S 6:15 &#39;(LE)0x00f6&#39; &quot;</span><span style="color:#24292E;">).</span><span style="color:#6F42C1;">arg</span><span style="color:#24292E;">(device);</span></span>
<span class="line"><span style="color:#24292E;">    QString str3</span><span style="color:#D73A49;">=</span><span style="color:#6F42C1;">tr</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;uvcdynctrl -d /dev/video%1 -S 6:8  &#39;(LE)0x2500&#39; &quot;</span><span style="color:#24292E;">).</span><span style="color:#6F42C1;">arg</span><span style="color:#24292E;">(device);</span></span>
<span class="line"><span style="color:#24292E;">    QString str4</span><span style="color:#D73A49;">=</span><span style="color:#6F42C1;">tr</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;uvcdynctrl -d /dev/video%1 -S 6:8  &#39;(LE)0x5ffe&#39; &quot;</span><span style="color:#24292E;">).</span><span style="color:#6F42C1;">arg</span><span style="color:#24292E;">(device);</span></span>
<span class="line"><span style="color:#24292E;">    QString str5</span><span style="color:#D73A49;">=</span><span style="color:#6F42C1;">tr</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;uvcdynctrl -d /dev/video%1 -S 6:15 &#39;(LE)0x0003&#39; &quot;</span><span style="color:#24292E;">).</span><span style="color:#6F42C1;">arg</span><span style="color:#24292E;">(device);</span></span>
<span class="line"><span style="color:#24292E;">    QString str6</span><span style="color:#D73A49;">=</span><span style="color:#6F42C1;">tr</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;uvcdynctrl -d /dev/video%1 -S 6:15 &#39;(LE)0x0002&#39; &quot;</span><span style="color:#24292E;">).</span><span style="color:#6F42C1;">arg</span><span style="color:#24292E;">(device);</span></span>
<span class="line"><span style="color:#24292E;">    QString str7</span><span style="color:#D73A49;">=</span><span style="color:#6F42C1;">tr</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;uvcdynctrl -d /dev/video%1 -S 6:15 &#39;(LE)0x0012&#39; &quot;</span><span style="color:#24292E;">).</span><span style="color:#6F42C1;">arg</span><span style="color:#24292E;">(device);</span></span>
<span class="line"><span style="color:#24292E;">    QString str8</span><span style="color:#D73A49;">=</span><span style="color:#6F42C1;">tr</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;uvcdynctrl -d /dev/video%1 -S 6:15 &#39;(LE)0x0004&#39; &quot;</span><span style="color:#24292E;">).</span><span style="color:#6F42C1;">arg</span><span style="color:#24292E;">(device);</span></span>
<span class="line"><span style="color:#24292E;">    QString str9</span><span style="color:#D73A49;">=</span><span style="color:#6F42C1;">tr</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;uvcdynctrl -d /dev/video%1 -S 6:8  &#39;(LE)0x76c3&#39; &quot;</span><span style="color:#24292E;">).</span><span style="color:#6F42C1;">arg</span><span style="color:#24292E;">(device);</span></span>
<span class="line"><span style="color:#24292E;">    QString str10</span><span style="color:#D73A49;">=</span><span style="color:#6F42C1;">tr</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;uvcdynctrl -d /dev/video%1 -S 6:10 &#39;(LE)0x0%200&#39;&quot;</span><span style="color:#24292E;">).</span><span style="color:#6F42C1;">arg</span><span style="color:#24292E;">(device).</span><span style="color:#6F42C1;">arg</span><span style="color:#24292E;">(mode);</span><span style="color:#6A737D;">  //可变参数</span></span>
<span class="line"><span style="color:#24292E;">    QString array[</span><span style="color:#005CC5;">10</span><span style="color:#24292E;">]</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">{str1,str2,str3,str4,str5,str6,str7,str8,str9,str10};</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">char</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;">n;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">for</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> i</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">;i</span><span style="color:#D73A49;">&lt;</span><span style="color:#005CC5;">10</span><span style="color:#24292E;">;i</span><span style="color:#D73A49;">++</span><span style="color:#24292E;">){</span></span>
<span class="line"><span style="color:#24292E;">        QByteArray m</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">array[i].</span><span style="color:#6F42C1;">toLatin1</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">        n</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">m.</span><span style="color:#6F42C1;">data</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">        process-&gt;</span><span style="color:#6F42C1;">write</span><span style="color:#24292E;">(n);</span></span>
<span class="line"><span style="color:#24292E;">        process-&gt;</span><span style="color:#6F42C1;">write</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;</span><span style="color:#005CC5;">\\n</span><span style="color:#032F62;">&quot;</span><span style="color:#24292E;">);</span><span style="color:#6A737D;">	//不可省略</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><ul><li><p>如何解决切换相机输出模式的问题？</p><p>在之前也提到了，在 terminal 中执行 sh 脚本不够优雅，但是又不想写更多的代码，所以怎么办呢？这里的解决思路是这样的。我们通过上位机通过按钮，触发一个分离线程启动 bash 终端，通过读取数组中的字符串命令 (由 shell 脚本中的 uvc 命令改写而来)，将之按照执行顺序存入数组中，再依次读出并写入到 bash 终端中即可实现。</p></li><li><p>如何解决在 Linux 下设备号经常变更而造成命令执行失败的问题？</p><p>我们希望可以向分离进程中传入可变参数，我们通过 QString 的 arg() 方法用于填充字符串中的%1,%2为给定的实参，这样就可以解决这一问题。</p></li><li><p>如何实现自动识别是否有可读取的摄像头设备？</p><p>我们在使用一些其他应用时，比如 cheese 时，无需输入任何参数就可以自动的读取视频数据流，需要用到获取常用硬件设备 GUID。</p></li></ul><h3 id="_3-拍照" tabindex="-1">3.拍照 <a class="header-anchor" href="#_3-拍照" aria-label="Permalink to &quot;3.拍照&quot;">​</a></h3><div class="language-c++ vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">c++</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#F47067;">void</span><span style="color:#ADBAC7;"> </span><span style="color:#F69D50;">MainWindow</span><span style="color:#ADBAC7;">::</span><span style="color:#DCBDFB;">on_Photograph_clicked</span><span style="color:#ADBAC7;">()</span></span>
<span class="line"><span style="color:#ADBAC7;">{</span></span>
<span class="line"><span style="color:#ADBAC7;">    QString timeStr </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#F69D50;">QDateTime</span><span style="color:#ADBAC7;">::</span><span style="color:#DCBDFB;">currentDateTime</span><span style="color:#ADBAC7;">().</span><span style="color:#DCBDFB;">toString</span><span style="color:#ADBAC7;">(</span><span style="color:#96D0FF;">&quot;yyyy-MM-hh hh_mm_ss&quot;</span><span style="color:#ADBAC7;">);</span></span>
<span class="line"><span style="color:#ADBAC7;">    QString dirName </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&quot;Pictures&quot;</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"><span style="color:#ADBAC7;">    QString homepath </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#F69D50;">QDir</span><span style="color:#ADBAC7;">::</span><span style="color:#DCBDFB;">homePath</span><span style="color:#ADBAC7;">();</span></span>
<span class="line"><span style="color:#ADBAC7;">    QImage image </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#DCBDFB;">MatImageToQt</span><span style="color:#ADBAC7;">(src_image);</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">if</span><span style="color:#ADBAC7;">(</span><span style="color:#F47067;">!</span><span style="color:#F69D50;">QFile</span><span style="color:#ADBAC7;">::</span><span style="color:#DCBDFB;">exists</span><span style="color:#ADBAC7;">(dirName))</span></span>
<span class="line"><span style="color:#ADBAC7;">    {</span></span>
<span class="line"><span style="color:#ADBAC7;">       QDir dir;</span></span>
<span class="line"><span style="color:#ADBAC7;">       </span><span style="color:#F47067;">if</span><span style="color:#ADBAC7;">(</span><span style="color:#F47067;">!</span><span style="color:#ADBAC7;">dir.</span><span style="color:#DCBDFB;">mkdir</span><span style="color:#ADBAC7;">(dirName))</span></span>
<span class="line"><span style="color:#ADBAC7;">       {</span></span>
<span class="line"><span style="color:#ADBAC7;">           ui-&gt;label_state-&gt;</span><span style="color:#DCBDFB;">setText</span><span style="color:#ADBAC7;">(</span><span style="color:#96D0FF;">&quot;创建文件夹 &quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">+</span><span style="color:#ADBAC7;"> dirName </span><span style="color:#F47067;">+</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&quot;失败!!!&quot;</span><span style="color:#ADBAC7;">);</span></span>
<span class="line"><span style="color:#ADBAC7;">       }</span></span>
<span class="line"><span style="color:#ADBAC7;">    }</span></span>
<span class="line"><span style="color:#ADBAC7;">    QString filePath </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#DCBDFB;">QString</span><span style="color:#ADBAC7;">(</span><span style="color:#96D0FF;">&quot;%1/%2/</span><span style="color:#F47067;">%3.p</span><span style="color:#96D0FF;">ng&quot;</span><span style="color:#ADBAC7;">).</span><span style="color:#DCBDFB;">arg</span><span style="color:#ADBAC7;">(homepath).</span><span style="color:#DCBDFB;">arg</span><span style="color:#ADBAC7;">(dirName).</span><span style="color:#DCBDFB;">arg</span><span style="color:#ADBAC7;">(timeStr);</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">if</span><span style="color:#ADBAC7;">(image.</span><span style="color:#DCBDFB;">save</span><span style="color:#ADBAC7;">(filePath))</span></span>
<span class="line"><span style="color:#ADBAC7;">    {</span></span>
<span class="line"><span style="color:#ADBAC7;">        ui-&gt;label_state-&gt;</span><span style="color:#DCBDFB;">setText</span><span style="color:#ADBAC7;">(</span><span style="color:#96D0FF;">&quot;保存照片至：&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">+</span><span style="color:#ADBAC7;"> filePath);</span></span>
<span class="line"><span style="color:#ADBAC7;">    }</span><span style="color:#F47067;">else</span><span style="color:#ADBAC7;">{</span></span>
<span class="line"><span style="color:#ADBAC7;">        ui-&gt;label_state-&gt;</span><span style="color:#DCBDFB;">setText</span><span style="color:#ADBAC7;">(</span><span style="color:#96D0FF;">&quot;保存照片失败!!!&quot;</span><span style="color:#ADBAC7;">);</span></span>
<span class="line"><span style="color:#ADBAC7;">    }</span></span>
<span class="line"><span style="color:#ADBAC7;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">MainWindow</span><span style="color:#24292E;">::</span><span style="color:#6F42C1;">on_Photograph_clicked</span><span style="color:#24292E;">()</span></span>
<span class="line"><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">    QString timeStr </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">QDateTime</span><span style="color:#24292E;">::</span><span style="color:#6F42C1;">currentDateTime</span><span style="color:#24292E;">().</span><span style="color:#6F42C1;">toString</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;yyyy-MM-hh hh_mm_ss&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">    QString dirName </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;Pictures&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    QString homepath </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">QDir</span><span style="color:#24292E;">::</span><span style="color:#6F42C1;">homePath</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">    QImage image </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">MatImageToQt</span><span style="color:#24292E;">(src_image);</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">if</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">!</span><span style="color:#6F42C1;">QFile</span><span style="color:#24292E;">::</span><span style="color:#6F42C1;">exists</span><span style="color:#24292E;">(dirName))</span></span>
<span class="line"><span style="color:#24292E;">    {</span></span>
<span class="line"><span style="color:#24292E;">       QDir dir;</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#D73A49;">if</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">!</span><span style="color:#24292E;">dir.</span><span style="color:#6F42C1;">mkdir</span><span style="color:#24292E;">(dirName))</span></span>
<span class="line"><span style="color:#24292E;">       {</span></span>
<span class="line"><span style="color:#24292E;">           ui-&gt;label_state-&gt;</span><span style="color:#6F42C1;">setText</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;创建文件夹 &quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> dirName </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;失败!!!&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">       }</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">    QString filePath </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">QString</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;%1/%2/</span><span style="color:#005CC5;">%3.p</span><span style="color:#032F62;">ng&quot;</span><span style="color:#24292E;">).</span><span style="color:#6F42C1;">arg</span><span style="color:#24292E;">(homepath).</span><span style="color:#6F42C1;">arg</span><span style="color:#24292E;">(dirName).</span><span style="color:#6F42C1;">arg</span><span style="color:#24292E;">(timeStr);</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">if</span><span style="color:#24292E;">(image.</span><span style="color:#6F42C1;">save</span><span style="color:#24292E;">(filePath))</span></span>
<span class="line"><span style="color:#24292E;">    {</span></span>
<span class="line"><span style="color:#24292E;">        ui-&gt;label_state-&gt;</span><span style="color:#6F42C1;">setText</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;保存照片至：&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> filePath);</span></span>
<span class="line"><span style="color:#24292E;">    }</span><span style="color:#D73A49;">else</span><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">        ui-&gt;label_state-&gt;</span><span style="color:#6F42C1;">setText</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;保存照片失败!!!&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><ul><li><p>如何实现存储图片到不同 Linux 主机的 Pictures 目录下？</p><p>首先，这里需要获取一下主文件夹名称，判断系统中是否存在对应目录（比如这里就是 Pictures）下的文件夹，通常情况下我们存储的图片都是以按下拍照按键的时刻来为图片命名，所以还需要获取一下系统的当前时间，最后，我们希望在按下按键后有一个反馈信号，以便知道是否成功保存图片和图片保存的位置。</p></li></ul><h3 id="_4-录像" tabindex="-1">4.录像 <a class="header-anchor" href="#_4-录像" aria-label="Permalink to &quot;4.录像&quot;">​</a></h3><div class="language-c++ vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">c++</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#F47067;">void</span><span style="color:#ADBAC7;"> </span><span style="color:#F69D50;">MainWindow</span><span style="color:#ADBAC7;">::</span><span style="color:#DCBDFB;">on_record_clicked</span><span style="color:#ADBAC7;">()</span></span>
<span class="line"><span style="color:#ADBAC7;">{</span></span>
<span class="line"><span style="color:#ADBAC7;">    QString timeStr </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#F69D50;">QDateTime</span><span style="color:#ADBAC7;">::</span><span style="color:#DCBDFB;">currentDateTime</span><span style="color:#ADBAC7;">().</span><span style="color:#DCBDFB;">toString</span><span style="color:#ADBAC7;">(</span><span style="color:#96D0FF;">&quot;yyyy-MM-hh hh_mm_ss&quot;</span><span style="color:#ADBAC7;">);</span></span>
<span class="line"><span style="color:#ADBAC7;">    QString dirName </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&quot;Videos&quot;</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"><span style="color:#ADBAC7;">    QString homepath </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#F69D50;">QDir</span><span style="color:#ADBAC7;">::</span><span style="color:#DCBDFB;">homePath</span><span style="color:#ADBAC7;">();</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">double</span><span style="color:#ADBAC7;"> fps </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">25.0</span><span style="color:#ADBAC7;">;</span><span style="color:#768390;">  // framerate of the created video stream</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">if</span><span style="color:#ADBAC7;">(</span><span style="color:#F47067;">!</span><span style="color:#F69D50;">QFile</span><span style="color:#ADBAC7;">::</span><span style="color:#DCBDFB;">exists</span><span style="color:#ADBAC7;">(dirName))</span></span>
<span class="line"><span style="color:#ADBAC7;">    {</span></span>
<span class="line"><span style="color:#ADBAC7;">       QDir dir;</span></span>
<span class="line"><span style="color:#ADBAC7;">       </span><span style="color:#F47067;">if</span><span style="color:#ADBAC7;">(</span><span style="color:#F47067;">!</span><span style="color:#ADBAC7;">dir.</span><span style="color:#DCBDFB;">mkdir</span><span style="color:#ADBAC7;">(dirName))</span></span>
<span class="line"><span style="color:#ADBAC7;">       {</span></span>
<span class="line"><span style="color:#ADBAC7;">           ui-&gt;label_state-&gt;</span><span style="color:#DCBDFB;">setText</span><span style="color:#ADBAC7;">(</span><span style="color:#96D0FF;">&quot;创建文件夹 &quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">+</span><span style="color:#ADBAC7;"> dirName </span><span style="color:#F47067;">+</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&quot;失败!!!&quot;</span><span style="color:#ADBAC7;">);</span></span>
<span class="line"><span style="color:#ADBAC7;">       }</span></span>
<span class="line"><span style="color:#ADBAC7;">    }</span></span>
<span class="line"><span style="color:#ADBAC7;">    QString filePath </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#DCBDFB;">QString</span><span style="color:#ADBAC7;">(</span><span style="color:#96D0FF;">&quot;%1/%2/</span><span style="color:#F47067;">%3.a</span><span style="color:#96D0FF;">vi&quot;</span><span style="color:#ADBAC7;">).</span><span style="color:#DCBDFB;">arg</span><span style="color:#ADBAC7;">(homepath).</span><span style="color:#DCBDFB;">arg</span><span style="color:#ADBAC7;">(dirName).</span><span style="color:#DCBDFB;">arg</span><span style="color:#ADBAC7;">(timeStr);</span></span>
<span class="line"><span style="color:#ADBAC7;">    cap.</span><span style="color:#DCBDFB;">open</span><span style="color:#ADBAC7;">(device.</span><span style="color:#DCBDFB;">toInt</span><span style="color:#ADBAC7;">());</span></span>
<span class="line"><span style="color:#ADBAC7;">    writer.</span><span style="color:#DCBDFB;">open</span><span style="color:#ADBAC7;">(filePath.</span><span style="color:#DCBDFB;">toStdString</span><span style="color:#ADBAC7;">(), </span><span style="color:#F69D50;">VideoWriter</span><span style="color:#ADBAC7;">::</span><span style="color:#DCBDFB;">fourcc</span><span style="color:#ADBAC7;">(</span><span style="color:#96D0FF;">&#39;M&#39;</span><span style="color:#ADBAC7;">, </span><span style="color:#96D0FF;">&#39;J&#39;</span><span style="color:#ADBAC7;">, </span><span style="color:#96D0FF;">&#39;P&#39;</span><span style="color:#ADBAC7;">, </span><span style="color:#96D0FF;">&#39;G&#39;</span><span style="color:#ADBAC7;">), fps, </span><span style="color:#DCBDFB;">Size</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">640</span><span style="color:#ADBAC7;">, </span><span style="color:#6CB6FF;">480</span><span style="color:#ADBAC7;">), </span><span style="color:#6CB6FF;">true</span><span style="color:#ADBAC7;">);</span></span>
<span class="line"><span style="color:#768390;">    // check if we succeeded</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">if</span><span style="color:#ADBAC7;">(</span><span style="color:#F47067;">!</span><span style="color:#ADBAC7;">writer.</span><span style="color:#DCBDFB;">isOpened</span><span style="color:#ADBAC7;">()) {</span></span>
<span class="line"><span style="color:#ADBAC7;">            cerr </span><span style="color:#F47067;">&lt;&lt;</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&quot;Could not open the output video file for write</span><span style="color:#F47067;">\\n</span><span style="color:#96D0FF;">&quot;</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"><span style="color:#ADBAC7;">        }</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">while</span><span style="color:#ADBAC7;">(</span><span style="color:#F47067;">!</span><span style="color:#ADBAC7;">src_image.</span><span style="color:#DCBDFB;">empty</span><span style="color:#ADBAC7;">())</span></span>
<span class="line"><span style="color:#ADBAC7;">       {</span></span>
<span class="line"><span style="color:#768390;">           // check if we succeeded</span></span>
<span class="line"><span style="color:#ADBAC7;">           </span><span style="color:#F47067;">if</span><span style="color:#ADBAC7;"> (</span><span style="color:#F47067;">!</span><span style="color:#ADBAC7;">cap.</span><span style="color:#DCBDFB;">read</span><span style="color:#ADBAC7;">(src_image)) {</span></span>
<span class="line"><span style="color:#ADBAC7;">               cerr </span><span style="color:#F47067;">&lt;&lt;</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&quot;ERROR! blank frame grabbed</span><span style="color:#F47067;">\\n</span><span style="color:#96D0FF;">&quot;</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"><span style="color:#ADBAC7;">               </span><span style="color:#F47067;">break</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"><span style="color:#ADBAC7;">           }</span></span>
<span class="line"><span style="color:#ADBAC7;">           cap </span><span style="color:#F47067;">&gt;&gt;</span><span style="color:#ADBAC7;"> src_image;</span></span>
<span class="line"><span style="color:#768390;">           //设置保存视频的格式为 AVI，编码为 MJPG</span></span>
<span class="line"><span style="color:#ADBAC7;">           writer.</span><span style="color:#DCBDFB;">write</span><span style="color:#ADBAC7;">(src_image);</span></span>
<span class="line"><span style="color:#ADBAC7;">           </span><span style="color:#DCBDFB;">imshow</span><span style="color:#ADBAC7;">(</span><span style="color:#96D0FF;">&quot;VideoPlay&quot;</span><span style="color:#ADBAC7;">, src_image);</span></span>
<span class="line"><span style="color:#ADBAC7;">           </span><span style="color:#F47067;">if</span><span style="color:#ADBAC7;"> (</span><span style="color:#DCBDFB;">waitKey</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">5</span><span style="color:#ADBAC7;">) </span><span style="color:#F47067;">&gt;=</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">0</span><span style="color:#ADBAC7;">)</span></span>
<span class="line"><span style="color:#ADBAC7;">               </span><span style="color:#F47067;">break</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"><span style="color:#ADBAC7;">           </span><span style="color:#F47067;">if</span><span style="color:#ADBAC7;">(</span><span style="color:#F47067;">!</span><span style="color:#ADBAC7;">writer.</span><span style="color:#DCBDFB;">isOpened</span><span style="color:#ADBAC7;">()) {</span></span>
<span class="line"><span style="color:#ADBAC7;">               ui-&gt;label_state-&gt;</span><span style="color:#DCBDFB;">setText</span><span style="color:#ADBAC7;">(</span><span style="color:#96D0FF;">&quot;保存视频至：&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">+</span><span style="color:#ADBAC7;"> filePath);</span></span>
<span class="line"><span style="color:#ADBAC7;">               </span><span style="color:#F47067;">break</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"><span style="color:#ADBAC7;">             }</span></span>
<span class="line"><span style="color:#ADBAC7;">       }</span></span>
<span class="line"><span style="color:#ADBAC7;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">MainWindow</span><span style="color:#24292E;">::</span><span style="color:#6F42C1;">on_record_clicked</span><span style="color:#24292E;">()</span></span>
<span class="line"><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">    QString timeStr </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">QDateTime</span><span style="color:#24292E;">::</span><span style="color:#6F42C1;">currentDateTime</span><span style="color:#24292E;">().</span><span style="color:#6F42C1;">toString</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;yyyy-MM-hh hh_mm_ss&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">    QString dirName </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;Videos&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    QString homepath </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">QDir</span><span style="color:#24292E;">::</span><span style="color:#6F42C1;">homePath</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">double</span><span style="color:#24292E;"> fps </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">25.0</span><span style="color:#24292E;">;</span><span style="color:#6A737D;">  // framerate of the created video stream</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">if</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">!</span><span style="color:#6F42C1;">QFile</span><span style="color:#24292E;">::</span><span style="color:#6F42C1;">exists</span><span style="color:#24292E;">(dirName))</span></span>
<span class="line"><span style="color:#24292E;">    {</span></span>
<span class="line"><span style="color:#24292E;">       QDir dir;</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#D73A49;">if</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">!</span><span style="color:#24292E;">dir.</span><span style="color:#6F42C1;">mkdir</span><span style="color:#24292E;">(dirName))</span></span>
<span class="line"><span style="color:#24292E;">       {</span></span>
<span class="line"><span style="color:#24292E;">           ui-&gt;label_state-&gt;</span><span style="color:#6F42C1;">setText</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;创建文件夹 &quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> dirName </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;失败!!!&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">       }</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">    QString filePath </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">QString</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;%1/%2/</span><span style="color:#005CC5;">%3.a</span><span style="color:#032F62;">vi&quot;</span><span style="color:#24292E;">).</span><span style="color:#6F42C1;">arg</span><span style="color:#24292E;">(homepath).</span><span style="color:#6F42C1;">arg</span><span style="color:#24292E;">(dirName).</span><span style="color:#6F42C1;">arg</span><span style="color:#24292E;">(timeStr);</span></span>
<span class="line"><span style="color:#24292E;">    cap.</span><span style="color:#6F42C1;">open</span><span style="color:#24292E;">(device.</span><span style="color:#6F42C1;">toInt</span><span style="color:#24292E;">());</span></span>
<span class="line"><span style="color:#24292E;">    writer.</span><span style="color:#6F42C1;">open</span><span style="color:#24292E;">(filePath.</span><span style="color:#6F42C1;">toStdString</span><span style="color:#24292E;">(), </span><span style="color:#6F42C1;">VideoWriter</span><span style="color:#24292E;">::</span><span style="color:#6F42C1;">fourcc</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;M&#39;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&#39;J&#39;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&#39;P&#39;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&#39;G&#39;</span><span style="color:#24292E;">), fps, </span><span style="color:#6F42C1;">Size</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">640</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">480</span><span style="color:#24292E;">), </span><span style="color:#005CC5;">true</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#6A737D;">    // check if we succeeded</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">if</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">!</span><span style="color:#24292E;">writer.</span><span style="color:#6F42C1;">isOpened</span><span style="color:#24292E;">()) {</span></span>
<span class="line"><span style="color:#24292E;">            cerr </span><span style="color:#D73A49;">&lt;&lt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;Could not open the output video file for write</span><span style="color:#005CC5;">\\n</span><span style="color:#032F62;">&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">while</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">!</span><span style="color:#24292E;">src_image.</span><span style="color:#6F42C1;">empty</span><span style="color:#24292E;">())</span></span>
<span class="line"><span style="color:#24292E;">       {</span></span>
<span class="line"><span style="color:#6A737D;">           // check if we succeeded</span></span>
<span class="line"><span style="color:#24292E;">           </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (</span><span style="color:#D73A49;">!</span><span style="color:#24292E;">cap.</span><span style="color:#6F42C1;">read</span><span style="color:#24292E;">(src_image)) {</span></span>
<span class="line"><span style="color:#24292E;">               cerr </span><span style="color:#D73A49;">&lt;&lt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;ERROR! blank frame grabbed</span><span style="color:#005CC5;">\\n</span><span style="color:#032F62;">&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">               </span><span style="color:#D73A49;">break</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">           }</span></span>
<span class="line"><span style="color:#24292E;">           cap </span><span style="color:#D73A49;">&gt;&gt;</span><span style="color:#24292E;"> src_image;</span></span>
<span class="line"><span style="color:#6A737D;">           //设置保存视频的格式为 AVI，编码为 MJPG</span></span>
<span class="line"><span style="color:#24292E;">           writer.</span><span style="color:#6F42C1;">write</span><span style="color:#24292E;">(src_image);</span></span>
<span class="line"><span style="color:#24292E;">           </span><span style="color:#6F42C1;">imshow</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;VideoPlay&quot;</span><span style="color:#24292E;">, src_image);</span></span>
<span class="line"><span style="color:#24292E;">           </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (</span><span style="color:#6F42C1;">waitKey</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">5</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">&gt;=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">               </span><span style="color:#D73A49;">break</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">           </span><span style="color:#D73A49;">if</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">!</span><span style="color:#24292E;">writer.</span><span style="color:#6F42C1;">isOpened</span><span style="color:#24292E;">()) {</span></span>
<span class="line"><span style="color:#24292E;">               ui-&gt;label_state-&gt;</span><span style="color:#6F42C1;">setText</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;保存视频至：&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> filePath);</span></span>
<span class="line"><span style="color:#24292E;">               </span><span style="color:#D73A49;">break</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">             }</span></span>
<span class="line"><span style="color:#24292E;">       }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><ul><li><p>如何实现存储视频到不同 Linux 主机的 Videos 目录下？</p><p>大致思路与保存图片差不多，这里就不详细介绍了，有兴趣的小伙伴自行研究一下。</p></li></ul><p>这是我的应用链接，欢迎种草：</p><p><a href="https://github.com/ruoxi521/Stereo_QT" target="_blank" rel="noreferrer">3D_WebCam 上位机</a></p><h2 id="致谢" tabindex="-1">致谢 <a class="header-anchor" href="#致谢" aria-label="Permalink to &quot;致谢&quot;">​</a></h2><p>OK！本期关于如何使用 Git、PicGo、Typora3 个工具快速撰写、部署文章就到此为止。喜欢的话请支持、转发、订阅！同时也欢迎各位大佬指出不足之处！在此本人万分感谢！</p>`,39);function b(s,E,g,h,_,q){const o=r,e=c("ClientOnly");return l(),y("div",null,[d,i(e,null,{default:A(()=>{var n,a;return[(((n=s.$frontmatter)==null?void 0:n.aside)??!0)&&(((a=s.$frontmatter)==null?void 0:a.showArticleMetadata)??!0)?(l(),B(o,{key:0,article:s.$frontmatter},null,8,["article"])):F("",!0)]}),_:1}),m])}const w=t(u,[["render",b]]);export{S as __pageData,w as default};
